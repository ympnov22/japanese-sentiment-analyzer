# 日本語感情分析アプリ改善タスクリスト

## 概要
メモリ問題とモデル予測バイアスの修正を中心とした改善計画

## Phase A: 緊急修正 (メモリ最適化・モデル修正)

### A1: バックエンドメモリ問題解決
| Task ID | タスク名 | 詳細 | 推定時間 |
|---------|----------|------|----------|
| A1-001 | 現在のメモリ使用量分析 | モデルファイルサイズ・読み込み時メモリ使用量測定 | 20分 |
| A1-002 | 軽量モデル実装検証 | 既存のLightweightSentimentModelの動作確認 | 30分 |
| A1-003 | モデル圧縮最適化 | numpy weights圧縮・float32使用・不要データ削除 | 45分 |
| A1-004 | 遅延読み込み改善 | 初回リクエスト時のメモリスパイク削減 | 30分 |
| A1-005 | Dockerイメージ最適化 | マルチステージビルド・不要パッケージ削除 | 40分 |
| A1-006 | Fly.io設定調整 | メモリ制限・スワップ設定・ヘルスチェック調整 | 25分 |

**Phase A1 合計: 190分 (約3.2時間)**

### A2: モデル予測バイアス修正
| Task ID | タスク名 | 詳細 | 推定時間 |
|---------|----------|------|----------|
| A2-001 | 現在の予測バイアス分析 | テストデータでの詳細予測結果分析 | 30分 |
| A2-002 | データバランス確認 | 訓練データのクラス分布・品質確認 | 25分 |
| A2-003 | 特徴量エンジニアリング改善 | 日本語前処理・TF-IDF設定最適化 | 50分 |
| A2-004 | ハイパーパラメータ調整 | クラス重み・正則化パラメータ最適化 | 60分 |
| A2-005 | モデル再訓練 | 改善された設定でのモデル再訓練 | 40分 |
| A2-006 | 予測精度検証 | テストデータでの性能評価・バイアス確認 | 35分 |

**Phase A2 合計: 240分 (約4時間)**

### A3: 統合テスト・デプロイ
| Task ID | タスク名 | 詳細 | 推定時間 |
|---------|----------|------|----------|
| A3-001 | ローカル統合テスト | 改善されたモデル・APIの動作確認 | 30分 |
| A3-002 | メモリ使用量テスト | 本番環境想定でのメモリ使用量測定 | 25分 |
| A3-003 | 予測精度テスト | 各クラスの予測精度・バイアス確認 | 35分 |
| A3-004 | バックエンドデプロイ | Fly.ioへの改善版デプロイ | 30分 |
| A3-005 | 本番環境動作確認 | デプロイ後の動作・性能確認 | 25分 |
| A3-006 | フロントエンド接続テスト | UI-API統合動作確認 | 20分 |

**Phase A3 合計: 165分 (約2.8時間)**

## Phase A 総合計: 595分 (約10時間)

## 詳細実装計画

### A1: メモリ最適化詳細

#### A1-001: 現在のメモリ使用量分析
- **目的**: 現在のメモリボトルネックを特定
- **実施内容**:
  - モデルファイルサイズ測定
  - 読み込み時のメモリ使用量プロファイリング
  - メモリスパイクのタイミング特定
- **成果物**: メモリ使用量分析レポート

#### A1-002: 軽量モデル実装検証
- **目的**: 既存の軽量化実装の動作確認
- **実施内容**:
  - LightweightSentimentModelクラスの動作テスト
  - numpy weights読み込み機能確認
  - joblib fallback機能確認
- **成果物**: 軽量モデル動作確認レポート

#### A1-003: モデル圧縮最適化
- **目的**: モデルサイズとメモリ使用量の削減
- **実施内容**:
  - float64 → float32変換
  - 不要なメタデータ削除
  - numpy配列の圧縮
  - mmap_mode活用
- **成果物**: 最適化されたモデルファイル

### A2: モデルバイアス修正詳細

#### A2-001: 予測バイアス分析
- **目的**: 現在のバイアスパターンを詳細分析
- **実施内容**:
  - 各クラスの予測分布分析
  - 誤分類パターンの特定
  - 確信度スコアの分布確認
- **成果物**: バイアス分析レポート

#### A2-003: 特徴量エンジニアリング改善
- **目的**: 日本語テキストの特徴抽出改善
- **実施内容**:
  - 日本語ストップワード追加
  - n-gram範囲調整
  - TF-IDF設定最適化
  - 文字正規化改善
- **成果物**: 改善された前処理パイプライン

#### A2-004: ハイパーパラメータ調整
- **目的**: クラス不均衡とバイアスの解決
- **実施内容**:
  - class_weight調整
  - 正則化パラメータ(C)最適化
  - solver設定確認
  - 交差検証による最適化
- **成果物**: 最適化されたモデル設定

## 成功基準

### メモリ最適化
- [ ] Fly.io無料枠(512MB)での安定動作
- [ ] 起動時間30秒以内
- [ ] メモリ使用量300MB以下
- [ ] OOMエラーの解消

### モデル精度改善
- [ ] 全クラス予測バイアスの解消
- [ ] ニュートラルクラスF1スコア40%以上
- [ ] 全体精度70%以上
- [ ] 各クラス最低50%以上のF1スコア

### 動作確認
- [ ] ローカル環境での正常動作
- [ ] 本番環境での安定動作
- [ ] フロントエンド-バックエンド統合動作
- [ ] レスポンス時間5秒以内

## リスク要因と対策

### 高リスク項目
1. **A1-003: モデル圧縮最適化** (45分)
   - リスク: 精度低下の可能性
   - 対策: 段階的圧縮・精度確認

2. **A2-004: ハイパーパラメータ調整** (60分)
   - リスク: 最適化に時間がかかる可能性
   - 対策: グリッドサーチ範囲を限定

3. **A3-004: バックエンドデプロイ** (30分)
   - リスク: デプロイ時の予期しない問題
   - 対策: ローカルでの十分なテスト

### 中リスク項目
- A1-005: Dockerイメージ最適化
- A2-005: モデル再訓練
- A3-001: 統合テスト

## 次フェーズ予告

### Phase B: 性能向上 (Phase A完了後)
- より高度なモデル(BERT等)の検討
- データセット拡張
- 詳細な評価指標実装

### Phase C: 機能拡張
- バッチ処理機能
- ユーザーフィードバック機能
- 分析履歴機能

---

**Phase A実装開始準備完了**
ユーザー承認後、A1-001から順次実装開始予定
