# Phase 1 å®Œäº†å ±å‘Š: ãƒ†ã‚¹ãƒˆå¼·åŒ–ã¨ãƒã‚¤ã‚¢ã‚¹åˆ†æ

## å®Ÿè¡Œæ—¥æ™‚
2025å¹´8æœˆ25æ—¥ 10:05 UTC

## å®Œäº†ã—ãŸã‚¿ã‚¹ã‚¯

### âœ… 1. ã‚µãƒ‹ãƒ†ã‚£ãƒ†ã‚¹ãƒˆè¿½åŠ 
- **å®Ÿè£…**: `backend/tests/test_model_accuracy.py` ã® `test_sanity_check()` ãƒ¡ã‚½ãƒƒãƒ‰
- **ãƒ†ã‚¹ãƒˆå†…å®¹**: 
  - ãƒã‚¸ãƒ†ã‚£ãƒ–ãƒ†ã‚­ã‚¹ãƒˆ: "æœ€é«˜ã«å¬‰ã—ã„ï¼"
  - ãƒã‚¬ãƒ†ã‚£ãƒ–ãƒ†ã‚­ã‚¹ãƒˆ: "æœ€æ‚ªã§è…¹ãŒç«‹ã¤ã€‚"
- **çµæœ**: **ğŸš¨ BIAS DETECTED** - ä¸¡æ–¹ã¨ã‚‚ã€Œãƒã‚¬ãƒ†ã‚£ãƒ–ã€ã¨åˆ†é¡ï¼ˆã‚¹ã‚³ã‚¢: 0.500ï¼‰

### âœ… 2. æ–°ã—ã„ç²¾åº¦ãƒ†ã‚¹ãƒˆå®Ÿè£…
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `backend/tests/test_model_accuracy.py` ä½œæˆå®Œäº†
- **è©•ä¾¡æŒ‡æ¨™**: accuracy, precision, recall, macro F1
- **æ··åŒè¡Œåˆ—**: ç”Ÿæˆãƒ»å¯è¦–åŒ–å®Œäº† (`outputs/confusion_matrix.png`)
- **ç¢ºç‡åˆ†å¸ƒãƒ’ã‚¹ãƒˆã‚°ãƒ©ãƒ **: ç”Ÿæˆå®Œäº† (`outputs/score_distribution.png`)
- **ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³æ¯”è¼ƒ**: DummyClassifier(strategy="most_frequent") ã¨ã®æ¯”è¼ƒå®Ÿè£…

### âœ… 3. ã‚¨ãƒ©ãƒ¼åˆ†æå®Ÿè£…
- **èª¤åˆ†é¡Top20ä»¶**: å‡ºåŠ›å®Œäº† (`outputs/error_analysis.json`)
- **ç‰¹å¾´èªåˆ†æ**: coef_ ã‚’ç”¨ã„ãŸä¸Šä½/ä¸‹ä½ä¿‚æ•°åˆ†æå®Ÿè£…
- **ã‚¨ãƒ©ãƒ¼ç‡**: 62.1% (910/1465ä»¶ã®èª¤åˆ†é¡)

## ğŸš¨ é‡å¤§ãªå•é¡Œç™ºè¦‹

### ãƒã‚¤ã‚¢ã‚¹æ¤œå‡ºçµæœ
```
Sanity Test Results:
Positive text: 'æœ€é«˜ã«å¬‰ã—ã„ï¼' -> ãƒã‚¬ãƒ†ã‚£ãƒ– (score: 0.500)
Negative text: 'æœ€æ‚ªã§è…¹ãŒç«‹ã¤ã€‚' -> ãƒã‚¬ãƒ†ã‚£ãƒ– (score: 0.500)
BIAS DETECTED: Both texts classified as 'ãƒã‚¬ãƒ†ã‚£ãƒ–' - Model shows clear bias!
```

### æ€§èƒ½æŒ‡æ¨™ï¼ˆç¾åœ¨ã®ãƒ¢ãƒ‡ãƒ« vs ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³ï¼‰
| æŒ‡æ¨™ | ç¾åœ¨ã®ãƒ¢ãƒ‡ãƒ« | DummyClassifier | å·®åˆ† |
|------|-------------|----------------|------|
| **Accuracy** | 0.379 | 0.620 | **-0.241** |
| **Macro F1** | 0.276 | 0.383 | **-0.107** |
| **Precision (macro)** | 0.315 | - | - |
| **Recall (macro)** | 0.498 | - | - |

### æ··åŒè¡Œåˆ—
```
Labels: ['ãƒã‚¬ãƒ†ã‚£ãƒ–', 'ãƒã‚¸ãƒ†ã‚£ãƒ–']
[[554   3]
 [907   1]]
```
- **ãƒã‚¬ãƒ†ã‚£ãƒ–**: 557ä»¶ä¸­554ä»¶æ­£è§£ï¼ˆ99.5%ï¼‰
- **ãƒã‚¸ãƒ†ã‚£ãƒ–**: 908ä»¶ä¸­1ä»¶æ­£è§£ï¼ˆ0.1%ï¼‰â† **æ¥µã‚ã¦æ·±åˆ»**

### ã‚¹ã‚³ã‚¢åˆ†å¸ƒåˆ†æ
- **ç¯„å›²**: 0.500 - 0.538ï¼ˆæ¥µã‚ã¦ç‹­ã„ï¼‰
- **å¹³å‡**: 0.500
- **æ¨™æº–åå·®**: 0.002
- **âš ï¸ è­¦å‘Š**: ã‚¹ã‚³ã‚¢ç¯„å›²ãŒ0.038ã¨éå¸¸ã«ç‹­ãã€æ˜ç¢ºãªãƒã‚¤ã‚¢ã‚¹ã‚’ç¤ºã—ã¦ã„ã‚‹

## è©³ç´°åˆ†æçµæœ

### 1. ãƒ¡ãƒ¢ãƒªãƒ»äºˆæ¸¬ãƒ†ã‚¹ãƒˆçµæœ
```
=== Memory and Prediction Analysis ===
1. Text: ã“ã®å•†å“ã¯æœ¬å½“ã«ç´ æ™´ã‚‰ã—ã„ã§ã™ï¼æœ€é«˜ã®å“è³ªã§å¤§æº€è¶³ã§ã™ã€‚
   Result: ãƒã‚¸ãƒ†ã‚£ãƒ– (confidence: 0.736) â† æ­£å¸¸
2. Text: æ™®é€šã®å•†å“ã ã¨æ€ã„ã¾ã™ã€‚ç‰¹ã«è‰¯ãã‚‚æ‚ªãã‚‚ã‚ã‚Šã¾ã›ã‚“ã€‚
   Result: ãƒã‚¬ãƒ†ã‚£ãƒ– (confidence: 0.500) â† ãƒã‚¤ã‚¢ã‚¹
3. Text: æœ€æ‚ªã®å•†å“ã§ã—ãŸã€‚äºŒåº¦ã¨è²·ã„ã¾ã›ã‚“ã€‚ãŠé‡‘ã®ç„¡é§„ã§ã—ãŸã€‚
   Result: ãƒã‚¬ãƒ†ã‚£ãƒ– (confidence: 0.749) â† æ­£å¸¸
4. Text: ã¾ã‚ã¾ã‚ã§ã™ã€‚
   Result: ãƒã‚¬ãƒ†ã‚£ãƒ– (confidence: 0.500) â† ãƒã‚¤ã‚¢ã‚¹
5. Text: ã¨ã¦ã‚‚è‰¯ã„ï¼
   Result: ãƒã‚¬ãƒ†ã‚£ãƒ– (confidence: 0.500) â† ãƒã‚¤ã‚¢ã‚¹
6. Text: ã²ã©ã„ã€‚
   Result: ãƒã‚¬ãƒ†ã‚£ãƒ– (confidence: 0.500) â† ãƒã‚¤ã‚¢ã‚¹
```

### 2. èª¤åˆ†é¡Top5ä¾‹
1. **True: ãƒã‚¬ãƒ†ã‚£ãƒ– | Pred: ãƒã‚¸ãƒ†ã‚£ãƒ– | Conf: 0.538**
   - Text: "å¤‰ãˆã‚‹æ‰‹é–“ã‚’æ°—ã«ã—ãªã„ã®ã§ã‚ã‚Œã°ã€æ™®é€šã®ã‚’äºŒã¤è²·ã£ãŸã»ã†ãŒã‚ˆã•ã’ã€‚"
2. **True: ãƒã‚¬ãƒ†ã‚£ãƒ– | Pred: ãƒã‚¸ãƒ†ã‚£ãƒ– | Conf: 0.529**
   - Text: "ãƒ—ãƒªãƒ³ã‚¿ãŒå®‰ä¾¡ãªã®ã«ã‚¤ãƒ³ã‚¯ãŒé«˜ã„ã€‚ã€‚ã€‚"
3. **True: ãƒã‚¸ãƒ†ã‚£ãƒ– | Pred: ãƒã‚¬ãƒ†ã‚£ãƒ– | Conf: 0.523**
   - Text: "ç°¡å˜ã«è²¼ã‚Œã¦è‰¯ã‹ã£ãŸã§ã™ã€‚"
4. **True: ãƒã‚¬ãƒ†ã‚£ãƒ– | Pred: ãƒã‚¸ãƒ†ã‚£ãƒ– | Conf: 0.510**
   - Text: "ã‚Šã‘ã„ã‚·ãƒ¼ãƒˆï¼‘ã‚‚ï¼’ã‚‚éå¸¸ã«å‰¥ãŒã—è¾›ã„"
5. **True: ãƒã‚¸ãƒ†ã‚£ãƒ– | Pred: ãƒã‚¬ãƒ†ã‚£ãƒ– | Conf: 0.500**
   - Text: "æºå¸¯ã‚·ãƒ§ãƒƒãƒ—ã§ãƒ–ãƒ©ãƒƒã‚¯ã®æœ¬ä½“ã—ã‹æ®‹ã£ã¦ã„ãªã‹ã£ãŸã®ã§ä»•æ–¹ãªãè³¼å…¥ã€‚"

### 3. ç‰¹å¾´èªåˆ†æ
- **Top positive coefficients**: æœ€å¤§å€¤ 1.057ï¼ˆ20å€‹ã®ç‰¹å¾´èªç‰¹å®šæ¸ˆã¿ï¼‰
- **Bottom negative coefficients**: æœ€å°å€¤ -0.997ï¼ˆ20å€‹ã®ç‰¹å¾´èªç‰¹å®šæ¸ˆã¿ï¼‰
- **ãƒ¢ãƒ‡ãƒ«ä¿‚æ•°**: åˆ©ç”¨å¯èƒ½ã€Phase 2ã§ã®è©³ç´°åˆ†æã«æ´»ç”¨å¯èƒ½

## å•é¡Œã®æ ¹æœ¬åŸå› åˆ†æ

### 1. ãƒ‡ãƒ¼ã‚¿ãƒªãƒ¼ã‚¯ã®å¯èƒ½æ€§
- ç¾åœ¨ã®å®Ÿè£…ã§ã¯å…¨ãƒ‡ãƒ¼ã‚¿ã§TF-IDFã‚’fitã—ã¦ã‹ã‚‰åˆ†å‰²ã—ã¦ã„ã‚‹å¯èƒ½æ€§
- æ¤œè¨¼ãƒ»ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã«æƒ…å ±ãŒæ¼ã‚Œã¦ã„ã‚‹

### 2. ã‚¯ãƒ©ã‚¹ä¸å‡è¡¡å•é¡Œ
- ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿: ãƒã‚¬ãƒ†ã‚£ãƒ–557ä»¶ vs ãƒã‚¸ãƒ†ã‚£ãƒ–908ä»¶
- `class_weight="balanced"` ãŒé©åˆ‡ã«æ©Ÿèƒ½ã—ã¦ã„ãªã„

### 3. TF-IDFãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®å•é¡Œ
- ç¾åœ¨ã®è¨­å®šãŒæ—¥æœ¬èªãƒ†ã‚­ã‚¹ãƒˆã«æœ€é©åŒ–ã•ã‚Œã¦ã„ãªã„
- n-gramã®ç¯„å›²ã€min_dfã€max_dfã®èª¿æ•´ãŒå¿…è¦

### 4. ç¢ºç‡æ ¡æ­£ã®æ¬ å¦‚
- äºˆæ¸¬ç¢ºç‡ãŒ0.5ä»˜è¿‘ã«é›†ä¸­
- CalibratedClassifierCVãŒæœªå®Ÿè£…

## Phase 2ã¸ã®ææ¡ˆ

### ğŸ¯ å„ªå…ˆåº¦1: ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³åŒ–ã¨ãƒªãƒ¼ã‚¯é˜²æ­¢
1. **Pipeline + StratifiedKFoldå®Ÿè£…**
   - å„foldå†…ã§fit/transformã‚’å®Ÿè¡Œ
   - ãƒ‡ãƒ¼ã‚¿ãƒªãƒ¼ã‚¯ã‚’å®Œå…¨ã«é˜²æ­¢

### ğŸ¯ å„ªå…ˆåº¦2: TF-IDFæœ€é©åŒ–
1. **æ¨å¥¨åˆæœŸè¨­å®š**:
   ```python
   TfidfVectorizer(
       analyzer='char',
       ngram_range=(3, 5),
       min_df=2,
       max_df=0.95,
       sublinear_tf=True,
       norm='l2'
   )
   ```

### ğŸ¯ å„ªå…ˆåº¦3: å­¦ç¿’å™¨æ”¹å–„
1. **LogisticRegressionè¨­å®š**:
   ```python
   LogisticRegression(
       class_weight='balanced',
       max_iter=200,
       n_jobs=-1,
       random_state=42
   )
   ```
2. **ãƒã‚¤ãƒ‘ãƒ¼ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æ¢ç´¢**: Cãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°
3. **CalibratedClassifierCVå°å…¥**: ç¢ºç‡æ ¡æ­£

### ğŸ¯ å„ªå…ˆåº¦4: é–¾å€¤æœ€é©åŒ–
1. **PRæ›²ç·šä½¿ç”¨**: F1æœ€å¤§åŒ–ã¾ãŸã¯Youden's J
2. **æ¤œè¨¼ã‚»ãƒƒãƒˆã§ã®æœ€é©é–¾å€¤æ±ºå®š**

## æˆåŠŸåŸºæº–ã®ç¾çŠ¶

| åŸºæº– | ç¾çŠ¶ | ç›®æ¨™ | çŠ¶æ…‹ |
|------|------|------|------|
| ã‚µãƒ‹ãƒ†ã‚£ãƒ†ã‚¹ãƒˆåŒºåˆ¥ | âŒ ä¸¡æ–¹ãƒã‚¬ãƒ†ã‚£ãƒ– | âœ… æ­£ã—ãåŒºåˆ¥ | **è¦æ”¹å–„** |
| macro F1 > baseline | âŒ 0.276 < 0.383 | âœ… > 0.383 | **è¦æ”¹å–„** |
| å…¨ä»¶ãƒã‚¸ãƒ†ã‚£ãƒ–è§£æ¶ˆ | âŒ å…¨ä»¶ãƒã‚¬ãƒ†ã‚£ãƒ– | âœ… ä¸¡ã‚¯ãƒ©ã‚¹åˆ†å¸ƒ | **è¦æ”¹å–„** |
| ç¢ºç‡åˆ†å¸ƒã®åºƒãŒã‚Š | âŒ 0.500-0.538 | âœ… 0.3-0.7ä»¥å¤– | **è¦æ”¹å–„** |

## ç”Ÿæˆãƒ•ã‚¡ã‚¤ãƒ«

### ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«
- âœ… `backend/tests/test_model_accuracy.py` - åŒ…æ‹¬çš„ãªç²¾åº¦ãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆ

### å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«
- âœ… `backend/outputs/confusion_matrix.png` - æ··åŒè¡Œåˆ—å¯è¦–åŒ–
- âœ… `backend/outputs/score_distribution.png` - ã‚¹ã‚³ã‚¢åˆ†å¸ƒãƒ’ã‚¹ãƒˆã‚°ãƒ©ãƒ 
- âœ… `backend/outputs/error_analysis.json` - è©³ç´°ã‚¨ãƒ©ãƒ¼åˆ†æ

## æ¤œè¨¼ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œçµæœ

### âœ… pytestå®Ÿè¡Œ
```bash
poetry run pytest tests/test_model_accuracy.py -v
# å…¨ãƒ†ã‚¹ãƒˆå®Ÿè¡Œå®Œäº†ã€ãƒã‚¤ã‚¢ã‚¹æ¤œå‡ºæˆåŠŸ
```

### âœ… ãƒ¡ãƒ¢ãƒªãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
```bash
poetry run python test_memory_and_prediction.py
# ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡: +3.7MBã€äºˆæ¸¬æ©Ÿèƒ½æ­£å¸¸å‹•ä½œç¢ºèª
```

## æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

**ğŸ”„ Phase 2æ‰¿èªå¾…ã¡**

Phase 1ã§ç‰¹å®šã•ã‚ŒãŸé‡å¤§ãªãƒã‚¤ã‚¢ã‚¹å•é¡Œã¨æ€§èƒ½åŠ£åŒ–ã‚’è§£æ±ºã™ã‚‹ãŸã‚ã€Phase 2ã®ãƒ¢ãƒ‡ãƒ«æ”¹å–„å®Ÿè£…ã®æ‰¿èªã‚’ãŠé¡˜ã„ã—ã¾ã™ã€‚

**Phase 2å®Ÿè£…äºˆå®š**:
1. Pipeline + StratifiedKFoldå®Ÿè£…ï¼ˆãƒ‡ãƒ¼ã‚¿ãƒªãƒ¼ã‚¯é˜²æ­¢ï¼‰
2. TF-IDFãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æœ€é©åŒ–
3. LogisticRegression + ãƒã‚¤ãƒ‘ãƒ¼ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æ¢ç´¢
4. CalibratedClassifierCVå°å…¥
5. é–¾å€¤æœ€é©åŒ–

---

**Repository**: ympnov22/japanese-sentiment-analyzer  
**Branch**: devin/1756116053-model-accuracy-improvement  
**Commit Hash**: [æ¬¡ã®commitå¾Œã«æ›´æ–°]  
**Link to Devin run**: https://app.devin.ai/sessions/5c2503a4e73c472dbd21f752507963b6  
**Requested by**: ãƒ¤ãƒã‚·ã‚¿ ãƒ¤ã‚¹ãƒ’ãƒ­ (@ympnov22)
